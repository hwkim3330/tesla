<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tesla FSD Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --tesla-blue: #2196F3;
            --tesla-green: #4CAF50;
            --tesla-red: #f44336;
            --tesla-orange: #FF9800;
            --tesla-gray: #37474F;
            --tesla-dark: #1a1a1a;
            --tesla-light: #eceff1;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: white;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            user-select: none;
        }

        /* Main Dashboard Layout - Tesla Style */
        .dashboard {
            display: grid;
            grid-template-columns: 180px 1fr 200px;
            grid-template-rows: 50px 1fr 80px;
            height: 100vh;
            background: linear-gradient(180deg, #1a1a1a 0%, #0d0d0d 100%);
        }

        /* Top Status Bar */
        .status-bar {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            background: rgba(0,0,0,0.5);
            border-bottom: 1px solid #333;
        }

        .status-left, .status-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: #aaa;
        }

        .status-icon {
            font-size: 14px;
        }

        .time {
            font-size: 15px;
            font-weight: 500;
            color: #fff;
        }

        /* Left Panel - Speed & Controls */
        .left-panel {
            display: flex;
            flex-direction: column;
            padding: 30px 20px;
            background: rgba(0,0,0,0.3);
            border-right: 1px solid #222;
        }

        .speed-display {
            text-align: center;
            margin-bottom: 30px;
        }

        .speed-value {
            font-size: 72px;
            font-weight: 300;
            line-height: 1;
            color: #fff;
        }

        .speed-unit {
            font-size: 16px;
            color: #888;
            margin-top: 5px;
        }

        .speed-limit-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .speed-limit-sign {
            width: 45px;
            height: 45px;
            border: 4px solid #e53935;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 700;
            background: #fff;
            color: #000;
        }

        .gear-indicator {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 40px;
        }

        .gear {
            font-size: 18px;
            font-weight: 500;
            color: #555;
            transition: all 0.2s;
        }

        .gear.active {
            color: #fff;
            font-size: 22px;
        }

        .battery-display {
            margin-top: auto;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }

        .battery-bar {
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
        }

        .battery-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 4px;
            transition: width 0.3s;
        }

        .battery-info {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: #888;
        }

        /* Main Visualization */
        .main-view {
            position: relative;
            overflow: hidden;
        }

        #viz-canvas {
            width: 100%;
            height: 100%;
        }

        /* FSD Status Overlay */
        .fsd-overlay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(0,0,0,0.7);
            padding: 10px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }

        .fsd-status-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--tesla-blue);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(33, 150, 243, 0.7); }
            50% { opacity: 0.8; box-shadow: 0 0 0 8px rgba(33, 150, 243, 0); }
        }

        .fsd-status-text {
            font-size: 14px;
            font-weight: 500;
        }

        .fsd-version {
            font-size: 11px;
            color: #888;
            background: rgba(255,255,255,0.1);
            padding: 3px 8px;
            border-radius: 4px;
        }

        /* Speed Profile & Arrival Options (V14 style) */
        .control-pills {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
        }

        .control-pill {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0,0,0,0.7);
            padding: 10px 18px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
            border: 1px solid transparent;
        }

        .control-pill:hover {
            background: rgba(255,255,255,0.1);
        }

        .control-pill.active {
            border-color: var(--tesla-blue);
        }

        .pill-icon {
            font-size: 16px;
        }

        .pill-label {
            font-size: 13px;
        }

        /* Right Panel - Navigation & Info */
        .right-panel {
            display: flex;
            flex-direction: column;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-left: 1px solid #222;
        }

        .nav-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .nav-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .nav-icon {
            font-size: 20px;
        }

        .nav-title {
            font-size: 14px;
            font-weight: 600;
        }

        .nav-info {
            font-size: 12px;
            color: #888;
            line-height: 1.5;
        }

        .nav-eta {
            font-size: 24px;
            font-weight: 300;
            color: var(--tesla-blue);
            margin-top: 10px;
        }

        .nav-distance {
            font-size: 12px;
            color: #888;
        }

        /* Detection List */
        .detection-card {
            flex: 1;
            overflow-y: auto;
        }

        .detection-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid #222;
            font-size: 12px;
        }

        .detection-icon {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            background: rgba(255,255,255,0.05);
        }

        .detection-info {
            flex: 1;
        }

        .detection-label {
            color: #fff;
        }

        .detection-detail {
            color: #666;
            font-size: 10px;
        }

        /* Bottom Bar */
        .bottom-bar {
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            background: rgba(0,0,0,0.5);
            border-top: 1px solid #333;
        }

        .media-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .media-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .now-playing {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .album-art {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 8px;
        }

        .track-info {
            font-size: 13px;
        }

        .track-title {
            font-weight: 500;
        }

        .track-artist {
            color: #888;
            font-size: 11px;
        }

        .quick-controls {
            display: flex;
            gap: 15px;
        }

        .quick-btn {
            width: 45px;
            height: 45px;
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            border: none;
            color: #888;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-btn:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .quick-btn.active {
            background: rgba(33, 150, 243, 0.2);
            color: var(--tesla-blue);
        }

        /* Vehicle Types (V14 enhanced) */
        .vehicle-type {
            position: absolute;
            padding: 3px 8px;
            background: rgba(0,0,0,0.7);
            border-radius: 4px;
            font-size: 10px;
            color: #fff;
            white-space: nowrap;
        }

        /* Temperature indicator */
        .temp-display {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .temp-value {
            font-size: 13px;
        }

        .temp-icon {
            font-size: 14px;
        }

        /* Floating Navigation */
        .float-nav {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1000;
        }

        .float-nav-toggle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0,0,0,0.8);
            border: 1px solid #333;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .float-nav-toggle:hover {
            background: #333;
        }

        .float-nav-toggle svg {
            width: 20px;
            height: 20px;
            fill: white;
        }

        .float-nav-menu {
            position: absolute;
            top: 45px;
            left: 0;
            background: rgba(0,0,0,0.95);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 8px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s;
            min-width: 150px;
        }

        .float-nav:hover .float-nav-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .float-nav-link {
            display: block;
            padding: 8px 12px;
            color: #aaa;
            text-decoration: none;
            font-size: 12px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .float-nav-link:hover {
            background: #333;
            color: white;
        }

        .float-nav-link.active {
            color: #3e6ae1;
        }
    </style>
</head>
<body>
    <!-- Floating Navigation -->
    <div class="float-nav">
        <div class="float-nav-toggle">
            <svg viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
        </div>
        <div class="float-nav-menu">
            <a href="index.html" class="float-nav-link">Autopilot</a>
            <a href="dashboard.html" class="float-nav-link active">Dashboard</a>
            <a href="architecture.html" class="float-nav-link">Architecture</a>
            <a href="hardware.html" class="float-nav-link">HW4/HW5</a>
            <a href="cameras.html" class="float-nav-link">8 Cameras</a>
            <a href="versions.html" class="float-nav-link">V12‚ÜíV15</a>
            <a href="demo.html" class="float-nav-link">Live Demo</a>
        </div>
    </div>
    <div class="dashboard">
        <!-- Top Status Bar -->
        <div class="status-bar">
            <div class="status-left">
                <div class="time" id="current-time">10:42 AM</div>
                <div class="temp-display">
                    <span class="temp-icon">üå°Ô∏è</span>
                    <span class="temp-value">23¬∞C</span>
                </div>
            </div>
            <div class="status-right">
                <div class="status-item">
                    <span class="status-icon">üì∂</span>
                    <span>LTE</span>
                </div>
                <div class="status-item">
                    <span class="status-icon">üìç</span>
                    <span>GPS</span>
                </div>
                <div class="status-item">
                    <span class="status-icon">üîã</span>
                    <span id="battery-pct">78%</span>
                </div>
            </div>
        </div>

        <!-- Left Panel -->
        <div class="left-panel">
            <div class="speed-display">
                <div class="speed-value" id="speed-display">65</div>
                <div class="speed-unit">km/h</div>
            </div>

            <div class="speed-limit-container">
                <div class="speed-limit-sign" id="speed-limit">80</div>
                <span style="font-size: 12px; color: #888;">LIMIT</span>
            </div>

            <div class="gear-indicator">
                <span class="gear" id="gear-p">P</span>
                <span class="gear" id="gear-r">R</span>
                <span class="gear" id="gear-n">N</span>
                <span class="gear active" id="gear-d">D</span>
            </div>

            <div class="battery-display">
                <div class="battery-bar">
                    <div class="battery-fill" id="battery-bar" style="width: 78%"></div>
                </div>
                <div class="battery-info">
                    <span id="range">285 km</span>
                    <span>78%</span>
                </div>
            </div>
        </div>

        <!-- Main Visualization -->
        <div class="main-view">
            <canvas id="viz-canvas"></canvas>

            <!-- FSD Status -->
            <div class="fsd-overlay">
                <div class="fsd-status-icon"></div>
                <span class="fsd-status-text">Full Self-Driving</span>
                <span class="fsd-version">V14.2</span>
            </div>

            <!-- Speed Profile & Arrival (V14 style) -->
            <div class="control-pills">
                <div class="control-pill active" id="speed-profile">
                    <span class="pill-icon">üöó</span>
                    <span class="pill-label">Standard</span>
                </div>
                <div class="control-pill" id="arrival-option">
                    <span class="pill-icon">üÖøÔ∏è</span>
                    <span class="pill-label">Park at Destination</span>
                </div>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
            <!-- Navigation -->
            <div class="nav-card">
                <div class="nav-header">
                    <span class="nav-icon">üß≠</span>
                    <span class="nav-title">Navigation</span>
                </div>
                <div class="nav-info">Tesla Supercharger</div>
                <div class="nav-info" style="color: #aaa;">Seoul, Gangnam</div>
                <div class="nav-eta">12 min</div>
                <div class="nav-distance">8.5 km away</div>
            </div>

            <!-- Detections -->
            <div class="nav-card detection-card">
                <div class="nav-header">
                    <span class="nav-icon">üëÅÔ∏è</span>
                    <span class="nav-title">Detections</span>
                </div>
                <div id="detection-list">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <!-- Bottom Bar -->
        <div class="bottom-bar">
            <div class="media-controls">
                <button class="media-btn">‚èÆÔ∏è</button>
                <button class="media-btn">‚è∏Ô∏è</button>
                <button class="media-btn">‚è≠Ô∏è</button>
            </div>

            <div class="now-playing">
                <div class="album-art"></div>
                <div class="track-info">
                    <div class="track-title">Driving Music</div>
                    <div class="track-artist">Spotify</div>
                </div>
            </div>

            <div class="quick-controls">
                <button class="quick-btn active">‚ùÑÔ∏è</button>
                <button class="quick-btn">üí∫</button>
                <button class="quick-btn">üîä</button>
                <button class="quick-btn">‚öôÔ∏è</button>
            </div>
        </div>
    </div>

    <script>
        // Tesla Dashboard Visualization
        class TeslaDashboard {
            constructor() {
                this.canvas = document.getElementById('viz-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.resize();

                this.time = 0;
                this.speed = 65;
                this.steering = 0;

                // Road and vehicle state
                this.roadCurvature = 0;
                this.laneOffset = 0;

                // Detected objects
                this.vehicles = [];
                this.pedestrians = [];
                this.trafficLights = [];

                // Generate initial scene
                this.generateScene();

                // Start animation
                this.animate();

                // Update time
                this.updateClock();
                setInterval(() => this.updateClock(), 1000);

                // Update detections
                setInterval(() => this.updateDetections(), 2000);

                window.addEventListener('resize', () => this.resize());
            }

            resize() {
                const rect = this.canvas.parentElement.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = rect.height;
                this.width = rect.width;
                this.height = rect.height;
            }

            updateClock() {
                const now = new Date();
                const hours = now.getHours();
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const ampm = hours >= 12 ? 'PM' : 'AM';
                const hour12 = hours % 12 || 12;
                document.getElementById('current-time').textContent = `${hour12}:${minutes} ${ampm}`;
            }

            generateScene() {
                // Generate vehicles
                this.vehicles = [];
                const vehicleCount = 3 + Math.floor(Math.random() * 3);

                for (let i = 0; i < vehicleCount; i++) {
                    this.vehicles.push({
                        x: (Math.random() - 0.5) * 200,
                        y: 50 + Math.random() * 200,
                        width: 35 + Math.random() * 15,
                        height: 55 + Math.random() * 20,
                        type: ['sedan', 'suv', 'truck', 'van'][Math.floor(Math.random() * 4)],
                        color: ['#3b82f6', '#64748b', '#ef4444', '#f59e0b', '#10b981'][Math.floor(Math.random() * 5)],
                        speed: 50 + Math.random() * 30,
                        lane: Math.floor(Math.random() * 3) - 1
                    });
                }

                // Traffic light
                this.trafficLights = [{
                    x: 0,
                    y: 80,
                    state: 'green',
                    distance: 120
                }];
            }

            update() {
                this.time += 0.016;

                // Update steering and road
                this.roadCurvature = Math.sin(this.time * 0.3) * 0.3;
                this.steering = this.roadCurvature * 15;
                this.laneOffset = Math.sin(this.time * 0.5) * 5;

                // Update speed
                this.speed = 60 + Math.sin(this.time * 0.2) * 10;
                document.getElementById('speed-display').textContent = Math.round(this.speed);

                // Update vehicles (relative movement)
                this.vehicles.forEach(v => {
                    v.y += (this.speed - v.speed) * 0.02;
                    if (v.y > 350) {
                        v.y = -50;
                        v.x = (Math.random() - 0.5) * 200;
                    }
                    if (v.y < -100) {
                        v.y = 350;
                    }
                });

                // Update traffic light
                if (Math.random() > 0.995) {
                    const states = ['red', 'yellow', 'green'];
                    const currentIdx = states.indexOf(this.trafficLights[0].state);
                    this.trafficLights[0].state = states[(currentIdx + 1) % 3];
                }
            }

            draw() {
                const ctx = this.ctx;
                const w = this.width;
                const h = this.height;
                const cx = w / 2;

                // Clear
                ctx.fillStyle = '#1a1a1a';
                ctx.fillRect(0, 0, w, h);

                // Draw sky/horizon gradient
                const skyGradient = ctx.createLinearGradient(0, 0, 0, h * 0.4);
                skyGradient.addColorStop(0, '#1a1a2e');
                skyGradient.addColorStop(1, '#2d3748');
                ctx.fillStyle = skyGradient;
                ctx.fillRect(0, 0, w, h * 0.4);

                // Draw road
                this.drawRoad(ctx, cx, h);

                // Draw lane markings
                this.drawLaneMarkings(ctx, cx, h);

                // Draw detected vehicles
                this.drawVehicles(ctx, cx, h);

                // Draw ego vehicle (bottom center)
                this.drawEgoVehicle(ctx, cx, h);

                // Draw traffic light indicator
                this.drawTrafficLight(ctx, cx);

                // Draw path prediction
                this.drawPathPrediction(ctx, cx, h);
            }

            drawRoad(ctx, cx, h) {
                const roadWidth = 300;
                const perspectiveNarrow = 0.15;

                // Road surface
                ctx.fillStyle = '#2d3748';
                ctx.beginPath();
                ctx.moveTo(cx - roadWidth / 2, h);
                ctx.lineTo(cx + roadWidth / 2, h);
                ctx.lineTo(cx + roadWidth * perspectiveNarrow, h * 0.35);
                ctx.lineTo(cx - roadWidth * perspectiveNarrow, h * 0.35);
                ctx.closePath();
                ctx.fill();

                // Road edge lines
                ctx.strokeStyle = '#4a5568';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(cx - roadWidth / 2, h);
                ctx.lineTo(cx - roadWidth * perspectiveNarrow, h * 0.35);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(cx + roadWidth / 2, h);
                ctx.lineTo(cx + roadWidth * perspectiveNarrow, h * 0.35);
                ctx.stroke();
            }

            drawLaneMarkings(ctx, cx, h) {
                const curveOffset = this.roadCurvature * 50;

                // Lane lines
                ctx.strokeStyle = '#fbbf24';
                ctx.lineWidth = 3;
                ctx.setLineDash([30, 30]);

                // Center lane
                ctx.beginPath();
                ctx.moveTo(cx + this.laneOffset, h);
                ctx.quadraticCurveTo(
                    cx + curveOffset + this.laneOffset,
                    h * 0.6,
                    cx + curveOffset * 2,
                    h * 0.35
                );
                ctx.stroke();

                // Left lane
                ctx.strokeStyle = '#3b82f6';
                ctx.beginPath();
                ctx.moveTo(cx - 80 + this.laneOffset, h);
                ctx.quadraticCurveTo(
                    cx - 50 + curveOffset + this.laneOffset,
                    h * 0.6,
                    cx - 20 + curveOffset * 2,
                    h * 0.35
                );
                ctx.stroke();

                // Right lane
                ctx.beginPath();
                ctx.moveTo(cx + 80 + this.laneOffset, h);
                ctx.quadraticCurveTo(
                    cx + 50 + curveOffset + this.laneOffset,
                    h * 0.6,
                    cx + 20 + curveOffset * 2,
                    h * 0.35
                );
                ctx.stroke();

                ctx.setLineDash([]);
            }

            drawVehicles(ctx, cx, h) {
                // Sort by y (distance) for proper layering
                const sortedVehicles = [...this.vehicles].sort((a, b) => a.y - b.y);

                sortedVehicles.forEach(v => {
                    const perspective = 1 - v.y / 400;
                    const scale = 0.3 + perspective * 0.7;
                    const x = cx + v.x * scale + this.roadCurvature * v.y * 0.3;
                    const y = h * 0.35 + v.y * scale;

                    if (y < h * 0.3 || y > h - 100) return;

                    const vw = v.width * scale;
                    const vh = v.height * scale;

                    // Vehicle shadow
                    ctx.fillStyle = 'rgba(0,0,0,0.3)';
                    ctx.fillRect(x - vw/2 + 5, y - vh/2 + 5, vw, vh);

                    // Vehicle body
                    const gradient = ctx.createLinearGradient(x, y - vh/2, x, y + vh/2);
                    gradient.addColorStop(0, v.color);
                    gradient.addColorStop(1, this.darkenColor(v.color, 0.3));
                    ctx.fillStyle = gradient;

                    this.roundRect(ctx, x - vw/2, y - vh/2, vw, vh, 5 * scale);
                    ctx.fill();

                    // Windshield
                    ctx.fillStyle = '#1a365d';
                    ctx.fillRect(x - vw/2 + 4*scale, y - vh/2 + 6*scale, vw - 8*scale, vh * 0.25);

                    // Taillights (if facing away)
                    ctx.fillStyle = '#ef4444';
                    ctx.fillRect(x - vw/2 + 2*scale, y + vh/2 - 6*scale, 6*scale, 4*scale);
                    ctx.fillRect(x + vw/2 - 8*scale, y + vh/2 - 6*scale, 6*scale, 4*scale);

                    // Detection box
                    ctx.strokeStyle = '#3b82f6';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(x - vw/2 - 5, y - vh/2 - 5, vw + 10, vh + 10);

                    // Distance label
                    const dist = Math.round((400 - v.y) * 0.5);
                    ctx.fillStyle = 'rgba(0,0,0,0.7)';
                    ctx.fillRect(x - 20, y - vh/2 - 25, 40, 18);
                    ctx.fillStyle = '#fff';
                    ctx.font = '11px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(`${dist}m`, x, y - vh/2 - 11);
                });
            }

            drawEgoVehicle(ctx, cx, h) {
                const egoY = h - 60;
                const egoW = 70;
                const egoH = 110;

                // Glow effect
                const glow = ctx.createRadialGradient(cx, egoY, 0, cx, egoY, 80);
                glow.addColorStop(0, 'rgba(59, 130, 246, 0.3)');
                glow.addColorStop(1, 'transparent');
                ctx.fillStyle = glow;
                ctx.beginPath();
                ctx.arc(cx, egoY, 80, 0, Math.PI * 2);
                ctx.fill();

                // Car body - Tesla Model 3 style
                const gradient = ctx.createLinearGradient(cx, egoY - egoH/2, cx, egoY + egoH/2);
                gradient.addColorStop(0, '#dc2626');
                gradient.addColorStop(1, '#991b1b');
                ctx.fillStyle = gradient;

                ctx.beginPath();
                ctx.moveTo(cx - egoW/2 + 10, egoY + egoH/2);
                ctx.lineTo(cx - egoW/2, egoY + egoH/4);
                ctx.lineTo(cx - egoW/2 + 5, egoY - egoH/4);
                ctx.quadraticCurveTo(cx - egoW/4, egoY - egoH/2 - 5, cx, egoY - egoH/2);
                ctx.quadraticCurveTo(cx + egoW/4, egoY - egoH/2 - 5, cx + egoW/2 - 5, egoY - egoH/4);
                ctx.lineTo(cx + egoW/2, egoY + egoH/4);
                ctx.lineTo(cx + egoW/2 - 10, egoY + egoH/2);
                ctx.closePath();
                ctx.fill();

                // Roof
                ctx.fillStyle = '#1f2937';
                ctx.beginPath();
                ctx.ellipse(cx, egoY - 10, egoW/2 - 12, egoH/4, 0, 0, Math.PI * 2);
                ctx.fill();

                // Windshield
                ctx.fillStyle = '#374151';
                ctx.beginPath();
                ctx.moveTo(cx - egoW/2 + 12, egoY - egoH/4 + 5);
                ctx.lineTo(cx - egoW/4, egoY - egoH/2 + 10);
                ctx.lineTo(cx + egoW/4, egoY - egoH/2 + 10);
                ctx.lineTo(cx + egoW/2 - 12, egoY - egoH/4 + 5);
                ctx.closePath();
                ctx.fill();

                // Tesla logo
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('T', cx, egoY + 5);
            }

            drawPathPrediction(ctx, cx, h) {
                const curveOffset = this.roadCurvature * 80;

                // Path line
                ctx.strokeStyle = 'rgba(16, 185, 129, 0.6)';
                ctx.lineWidth = 8;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(cx, h - 60);

                for (let i = 0; i < 50; i++) {
                    const progress = i / 50;
                    const y = h - 60 - progress * (h * 0.5);
                    const curve = curveOffset * progress * progress;
                    ctx.lineTo(cx + curve, y);
                }
                ctx.stroke();

                // Path dots
                ctx.fillStyle = '#10b981';
                for (let i = 0; i < 10; i++) {
                    const progress = i / 10;
                    const y = h - 60 - progress * (h * 0.5);
                    const curve = curveOffset * progress * progress;
                    const size = 4 - progress * 2;
                    ctx.beginPath();
                    ctx.arc(cx + curve, y, size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            drawTrafficLight(ctx, cx) {
                const tl = this.trafficLights[0];
                const x = cx + 100;
                const y = 80;

                // Pole
                ctx.fillStyle = '#374151';
                ctx.fillRect(x - 3, y, 6, 60);

                // Housing
                ctx.fillStyle = '#1f2937';
                this.roundRect(ctx, x - 15, y - 50, 30, 55, 5);
                ctx.fill();

                // Lights
                const colors = {
                    red: tl.state === 'red' ? '#ef4444' : '#4b1c1c',
                    yellow: tl.state === 'yellow' ? '#fbbf24' : '#4b3f1c',
                    green: tl.state === 'green' ? '#10b981' : '#1c4b3f'
                };

                ['red', 'yellow', 'green'].forEach((color, i) => {
                    ctx.fillStyle = colors[color];
                    ctx.beginPath();
                    ctx.arc(x, y - 35 + i * 18, 7, 0, Math.PI * 2);
                    ctx.fill();

                    // Glow effect for active light
                    if (tl.state === color) {
                        const glow = ctx.createRadialGradient(x, y - 35 + i * 18, 0, x, y - 35 + i * 18, 20);
                        glow.addColorStop(0, colors[color] + '88');
                        glow.addColorStop(1, 'transparent');
                        ctx.fillStyle = glow;
                        ctx.beginPath();
                        ctx.arc(x, y - 35 + i * 18, 20, 0, Math.PI * 2);
                        ctx.fill();
                    }
                });

                // Distance
                ctx.fillStyle = '#fff';
                ctx.font = '11px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`${tl.distance}m`, x, y + 75);
            }

            updateDetections() {
                const detections = [
                    { icon: 'üöó', label: 'Vehicle ahead', detail: '45m, 62 km/h' },
                    { icon: 'üöô', label: 'SUV (left lane)', detail: '32m' },
                    { icon: 'üö¶', label: 'Traffic light', detail: 'GREEN, 120m' },
                    { icon: 'üõ£Ô∏è', label: 'Lane markings', detail: 'Centered' },
                    { icon: '‚ö†Ô∏è', label: 'Speed limit', detail: '80 km/h' }
                ];

                const listEl = document.getElementById('detection-list');
                listEl.innerHTML = detections.map(d => `
                    <div class="detection-item">
                        <div class="detection-icon">${d.icon}</div>
                        <div class="detection-info">
                            <div class="detection-label">${d.label}</div>
                            <div class="detection-detail">${d.detail}</div>
                        </div>
                    </div>
                `).join('');
            }

            roundRect(ctx, x, y, w, h, r) {
                ctx.beginPath();
                ctx.moveTo(x + r, y);
                ctx.lineTo(x + w - r, y);
                ctx.quadraticCurveTo(x + w, y, x + w, y + r);
                ctx.lineTo(x + w, y + h - r);
                ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
                ctx.lineTo(x + r, y + h);
                ctx.quadraticCurveTo(x, y + h, x, y + h - r);
                ctx.lineTo(x, y + r);
                ctx.quadraticCurveTo(x, y, x + r, y);
                ctx.closePath();
            }

            darkenColor(color, amount) {
                const hex = color.replace('#', '');
                const r = Math.max(0, parseInt(hex.substr(0, 2), 16) - 255 * amount);
                const g = Math.max(0, parseInt(hex.substr(2, 2), 16) - 255 * amount);
                const b = Math.max(0, parseInt(hex.substr(4, 2), 16) - 255 * amount);
                return `rgb(${r}, ${g}, ${b})`;
            }

            animate() {
                this.update();
                this.draw();
                requestAnimationFrame(() => this.animate());
            }
        }

        // Speed profile toggle
        document.getElementById('speed-profile').addEventListener('click', function() {
            const modes = ['Standard', 'Chill', 'Assertive'];
            const icons = ['üöó', 'üê¢', 'üöÄ'];
            const current = this.querySelector('.pill-label').textContent;
            const idx = modes.indexOf(current);
            const next = (idx + 1) % modes.length;
            this.querySelector('.pill-label').textContent = modes[next];
            this.querySelector('.pill-icon').textContent = icons[next];
        });

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            window.dashboard = new TeslaDashboard();
        });
    </script>
</body>
</html>
