<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesla FSD - Vision System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-primary: #fafafa;
            --bg-secondary: #ffffff;
            --text-primary: #171717;
            --text-secondary: #525252;
            --text-muted: #a3a3a3;
            --accent: #2563eb;
            --accent-light: #3b82f6;
            --success: #16a34a;
            --border: #e5e5e5;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        .app {
            display: grid;
            grid-template-columns: 220px 1fr 280px;
            height: 100vh;
        }

        /* Left Panel */
        .left-panel {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            padding: 32px 24px;
            display: flex;
            flex-direction: column;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 48px;
        }

        .brand-logo {
            width: 32px;
            height: 32px;
        }

        .brand-text {
            font-size: 15px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .speed-block {
            text-align: center;
            padding: 32px 0;
            border-bottom: 1px solid var(--border);
        }

        .speed-value {
            font-size: 96px;
            font-weight: 300;
            line-height: 1;
            color: var(--text-primary);
            letter-spacing: -6px;
        }

        .speed-unit {
            font-size: 14px;
            color: var(--text-muted);
            font-weight: 400;
            margin-top: 8px;
            letter-spacing: 2px;
        }

        .limit-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 24px;
            padding: 8px 16px;
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
        }

        .limit-circle {
            width: 28px;
            height: 28px;
            border: 3px solid #dc2626;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .limit-text {
            font-size: 12px;
            color: #991b1b;
            font-weight: 500;
        }

        .status-section {
            padding: 24px 0;
            border-bottom: 1px solid var(--border);
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
        }

        .status-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .status-value {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .gear-block {
            display: flex;
            justify-content: center;
            gap: 24px;
            padding: 24px 0;
        }

        .gear {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-muted);
            transition: all 0.2s;
        }

        .gear.active {
            color: var(--text-primary);
            font-weight: 600;
        }

        .energy-section {
            margin-top: auto;
        }

        .energy-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .energy-label {
            font-size: 12px;
            color: var(--text-muted);
        }

        .energy-value {
            font-size: 12px;
            font-weight: 600;
            color: var(--success);
        }

        .energy-bar {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
        }

        .energy-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #4ade80);
            border-radius: 3px;
        }

        .range-display {
            text-align: center;
            margin-top: 16px;
        }

        .range-value {
            font-size: 28px;
            font-weight: 300;
            color: var(--text-primary);
        }

        .range-unit {
            font-size: 12px;
            color: var(--text-muted);
            margin-left: 4px;
        }

        /* Main View */
        .main-view {
            position: relative;
            background: linear-gradient(180deg, #f5f5f5 0%, #e5e5e5 100%);
        }

        #canvas-container {
            width: 100%;
            height: 100%;
        }

        .fsd-indicator {
            position: absolute;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-secondary);
            padding: 12px 24px;
            border-radius: 100px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.08);
        }

        .fsd-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .fsd-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .fsd-version {
            font-size: 11px;
            color: var(--text-muted);
            padding: 4px 8px;
            background: var(--bg-primary);
            border-radius: 4px;
        }

        .info-overlay {
            position: absolute;
            bottom: 24px;
            left: 24px;
            display: flex;
            gap: 12px;
        }

        .info-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-secondary);
            padding: 10px 16px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
        }

        .info-chip-value {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .info-chip-label {
            font-size: 11px;
            color: var(--text-muted);
        }

        /* Right Panel */
        .right-panel {
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
        }

        .card {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .card-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--accent), var(--accent-light));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .card-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .nav-content {
            margin-bottom: 16px;
        }

        .nav-destination {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .nav-address {
            font-size: 12px;
            color: var(--text-muted);
        }

        .nav-stats {
            display: flex;
            gap: 24px;
        }

        .nav-stat-value {
            font-size: 24px;
            font-weight: 300;
            color: var(--accent);
        }

        .nav-stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detection-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .detection-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border-left: 3px solid var(--accent);
        }

        .detection-item.caution {
            border-left-color: #f59e0b;
        }

        .det-icon-wrap {
            width: 32px;
            height: 32px;
            background: var(--bg-primary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }

        .det-info {
            flex: 1;
        }

        .det-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .det-meta {
            font-size: 11px;
            color: var(--text-muted);
        }

        .det-distance {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .metric-item {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 14px;
            text-align: center;
        }

        .metric-value {
            font-size: 20px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .metric-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .confidence-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .confidence-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .confidence-label {
            font-size: 12px;
            color: var(--text-muted);
        }

        .confidence-value {
            font-size: 12px;
            font-weight: 600;
            color: var(--success);
        }

        .confidence-bar {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: var(--success);
            border-radius: 2px;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Left Panel -->
        <div class="left-panel">
            <div class="brand">
                <svg class="brand-logo" viewBox="0 0 32 32" fill="none">
                    <path d="M16 4L8 8v6c0 5.5 3.4 10.6 8 12 4.6-1.4 8-6.5 8-12V8l-8-4z" fill="#e82127"/>
                    <path d="M16 6l6 3v5c0 4.4-2.7 8.5-6 9.6V6z" fill="#c91c21"/>
                    <text x="11" y="18" font-size="8" font-weight="bold" fill="white">T</text>
                </svg>
                <span class="brand-text">TESLA FSD</span>
            </div>

            <div class="speed-block">
                <div class="speed-value" id="speed">72</div>
                <div class="speed-unit">KM/H</div>
                <div class="limit-badge">
                    <div class="limit-circle">80</div>
                    <span class="limit-text">Speed Limit</span>
                </div>
            </div>

            <div class="status-section">
                <div class="status-row">
                    <span class="status-label">
                        <i data-lucide="gauge" style="width:16px;height:16px"></i>
                        Power
                    </span>
                    <span class="status-value" id="power">+38 kW</span>
                </div>
                <div class="status-row">
                    <span class="status-label">
                        <i data-lucide="thermometer" style="width:16px;height:16px"></i>
                        Temperature
                    </span>
                    <span class="status-value">23°C</span>
                </div>
                <div class="status-row">
                    <span class="status-label">
                        <i data-lucide="route" style="width:16px;height:16px"></i>
                        Trip
                    </span>
                    <span class="status-value" id="trip">47.3 km</span>
                </div>
            </div>

            <div class="gear-block">
                <span class="gear">P</span>
                <span class="gear">R</span>
                <span class="gear">N</span>
                <span class="gear active">D</span>
            </div>

            <div class="energy-section">
                <div class="energy-header">
                    <span class="energy-label">Battery</span>
                    <span class="energy-value">78%</span>
                </div>
                <div class="energy-bar">
                    <div class="energy-fill" style="width: 78%"></div>
                </div>
                <div class="range-display">
                    <span class="range-value">312</span>
                    <span class="range-unit">km range</span>
                </div>
            </div>
        </div>

        <!-- Main 3D View -->
        <div class="main-view">
            <div id="canvas-container"></div>

            <div class="fsd-indicator">
                <div class="fsd-dot"></div>
                <span class="fsd-label">Full Self-Driving</span>
                <span class="fsd-version">v14.2.1</span>
            </div>

            <div class="info-overlay">
                <div class="info-chip">
                    <i data-lucide="cpu" style="width:16px;height:16px;color:#525252"></i>
                    <div>
                        <div class="info-chip-value" id="inference">12.4ms</div>
                        <div class="info-chip-label">Inference</div>
                    </div>
                </div>
                <div class="info-chip">
                    <i data-lucide="video" style="width:16px;height:16px;color:#525252"></i>
                    <div>
                        <div class="info-chip-value" id="fps">36 FPS</div>
                        <div class="info-chip-label">Render</div>
                    </div>
                </div>
                <div class="info-chip">
                    <i data-lucide="scan" style="width:16px;height:16px;color:#525252"></i>
                    <div>
                        <div class="info-chip-value" id="objects">12</div>
                        <div class="info-chip-label">Objects</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i data-lucide="navigation" style="width:18px;height:18px"></i>
                    </div>
                    <span class="card-title">Navigation</span>
                </div>
                <div class="nav-content">
                    <div class="nav-destination">Tesla Supercharger</div>
                    <div class="nav-address">Seoul, Gangnam Station</div>
                </div>
                <div class="nav-stats">
                    <div>
                        <div class="nav-stat-value">12</div>
                        <div class="nav-stat-label">Minutes</div>
                    </div>
                    <div>
                        <div class="nav-stat-value">8.5</div>
                        <div class="nav-stat-label">Kilometers</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i data-lucide="scan-search" style="width:18px;height:18px"></i>
                    </div>
                    <span class="card-title">Detections</span>
                </div>
                <div class="detection-list" id="detection-list">
                    <div class="detection-item">
                        <div class="det-icon-wrap">
                            <i data-lucide="car" style="width:16px;height:16px"></i>
                        </div>
                        <div class="det-info">
                            <div class="det-label">Vehicle</div>
                            <div class="det-meta">Lane 2 · Moving</div>
                        </div>
                        <span class="det-distance">45m</span>
                    </div>
                    <div class="detection-item caution">
                        <div class="det-icon-wrap">
                            <i data-lucide="person-standing" style="width:16px;height:16px"></i>
                        </div>
                        <div class="det-info">
                            <div class="det-label">Pedestrian</div>
                            <div class="det-meta">Right side · Crossing</div>
                        </div>
                        <span class="det-distance">32m</span>
                    </div>
                    <div class="detection-item">
                        <div class="det-icon-wrap">
                            <i data-lucide="traffic-cone" style="width:16px;height:16px"></i>
                        </div>
                        <div class="det-info">
                            <div class="det-label">Traffic Light</div>
                            <div class="det-meta">Green · 15s remaining</div>
                        </div>
                        <span class="det-distance">85m</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i data-lucide="activity" style="width:18px;height:18px"></i>
                    </div>
                    <span class="card-title">System Metrics</span>
                </div>
                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-value" id="gpu">92%</div>
                        <div class="metric-label">GPU Load</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">45°C</div>
                        <div class="metric-label">SOC Temp</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">12.4</div>
                        <div class="metric-label">GB Memory</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">8</div>
                        <div class="metric-label">Cameras</div>
                    </div>
                </div>
                <div class="confidence-section">
                    <div class="confidence-header">
                        <span class="confidence-label">Model Confidence</span>
                        <span class="confidence-value" id="conf">97.2%</span>
                    </div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="conf-bar" style="width: 97%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Three.js Scene
        let scene, camera, renderer;
        let egoVehicle, vehicles = [];
        let time = 0;

        function init() {
            const container = document.getElementById('canvas-container');
            const width = container.clientWidth;
            const height = container.clientHeight;

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xf5f5f5);
            scene.fog = new THREE.Fog(0xf5f5f5, 80, 250);

            camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 1000);
            camera.position.set(0, 12, 20);
            camera.lookAt(0, 0, -30);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(width, height);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);

            // Lighting
            const ambient = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambient);

            const sun = new THREE.DirectionalLight(0xffffff, 0.8);
            sun.position.set(20, 40, 20);
            sun.castShadow = true;
            sun.shadow.mapSize.width = 2048;
            sun.shadow.mapSize.height = 2048;
            sun.shadow.camera.near = 0.5;
            sun.shadow.camera.far = 100;
            sun.shadow.camera.left = -50;
            sun.shadow.camera.right = 50;
            sun.shadow.camera.top = 50;
            sun.shadow.camera.bottom = -50;
            scene.add(sun);

            createEnvironment();
            createEgoVehicle();
            createTraffic();

            window.addEventListener('resize', onResize);
            animate();
        }

        function createEnvironment() {
            // Ground
            const groundGeo = new THREE.PlaneGeometry(300, 400);
            const groundMat = new THREE.MeshStandardMaterial({
                color: 0xe5e5e5,
                roughness: 0.9
            });
            const ground = new THREE.Mesh(groundGeo, groundMat);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // Road
            const roadGeo = new THREE.PlaneGeometry(14, 400);
            const roadMat = new THREE.MeshStandardMaterial({
                color: 0x404040,
                roughness: 0.8
            });
            const road = new THREE.Mesh(roadGeo, roadMat);
            road.rotation.x = -Math.PI / 2;
            road.position.y = 0.01;
            road.receiveShadow = true;
            scene.add(road);

            // Lane markings
            const laneMat = new THREE.MeshStandardMaterial({ color: 0xffffff });

            // Edge lines
            [-7, 7].forEach(x => {
                const edge = new THREE.Mesh(
                    new THREE.PlaneGeometry(0.15, 400),
                    laneMat
                );
                edge.rotation.x = -Math.PI / 2;
                edge.position.set(x, 0.02, 0);
                scene.add(edge);
            });

            // Dashed center lines
            const dashMat = new THREE.MeshStandardMaterial({ color: 0xfbbf24 });
            for (let z = -200; z < 200; z += 8) {
                [-3.5, 0, 3.5].forEach(x => {
                    const dash = new THREE.Mesh(
                        new THREE.PlaneGeometry(0.1, 4),
                        x === 0 ? dashMat : laneMat
                    );
                    dash.rotation.x = -Math.PI / 2;
                    dash.position.set(x, 0.02, z);
                    scene.add(dash);
                });
            }

            // Path prediction
            const pathCurve = new THREE.CatmullRomCurve3([
                new THREE.Vector3(0, 0.05, 10),
                new THREE.Vector3(0, 0.05, -20),
                new THREE.Vector3(0, 0.05, -60)
            ]);

            const pathGeo = new THREE.TubeGeometry(pathCurve, 64, 1.2, 8, false);
            const pathMat = new THREE.MeshStandardMaterial({
                color: 0x22c55e,
                transparent: true,
                opacity: 0.25
            });
            const path = new THREE.Mesh(pathGeo, pathMat);
            scene.add(path);

            // Path center line
            const lineMat = new THREE.LineBasicMaterial({ color: 0x16a34a });
            const lineGeo = new THREE.BufferGeometry().setFromPoints(pathCurve.getPoints(50));
            const line = new THREE.Line(lineGeo, lineMat);
            line.position.y = 0.1;
            scene.add(line);
        }

        function createEgoVehicle() {
            const group = new THREE.Group();

            // Body material - clean white
            const bodyMat = new THREE.MeshStandardMaterial({
                color: 0xffffff,
                metalness: 0.4,
                roughness: 0.35
            });

            // Main body
            const bodyGeo = new THREE.BoxGeometry(2.1, 0.6, 4.8);
            const body = new THREE.Mesh(bodyGeo, bodyMat);
            body.position.y = 0.5;
            body.castShadow = true;
            group.add(body);

            // Cabin
            const cabinGeo = new THREE.BoxGeometry(1.9, 0.6, 2.4);
            const cabin = new THREE.Mesh(cabinGeo, bodyMat);
            cabin.position.set(0, 1.0, -0.3);
            cabin.castShadow = true;
            group.add(cabin);

            // Glass
            const glassMat = new THREE.MeshStandardMaterial({
                color: 0x1e293b,
                metalness: 0.9,
                roughness: 0.1,
                transparent: true,
                opacity: 0.8
            });

            // Windshield
            const windshield = new THREE.Mesh(
                new THREE.PlaneGeometry(1.7, 0.7),
                glassMat
            );
            windshield.position.set(0, 1.2, 1.0);
            windshield.rotation.x = -0.35;
            group.add(windshield);

            // Rear window
            const rearWindow = new THREE.Mesh(
                new THREE.PlaneGeometry(1.7, 0.6),
                glassMat
            );
            rearWindow.position.set(0, 1.15, -1.5);
            rearWindow.rotation.x = 0.35;
            group.add(rearWindow);

            // Wheels
            const wheelGeo = new THREE.CylinderGeometry(0.38, 0.38, 0.25, 32);
            const wheelMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a });
            const rimGeo = new THREE.CylinderGeometry(0.28, 0.28, 0.26, 8);
            const rimMat = new THREE.MeshStandardMaterial({ color: 0xd4d4d4, metalness: 0.8 });

            [[-0.95, 0.38, 1.5], [0.95, 0.38, 1.5], [-0.95, 0.38, -1.5], [0.95, 0.38, -1.5]].forEach(pos => {
                const wheel = new THREE.Mesh(wheelGeo, wheelMat);
                wheel.rotation.z = Math.PI / 2;
                wheel.position.set(...pos);
                wheel.castShadow = true;
                group.add(wheel);

                const rim = new THREE.Mesh(rimGeo, rimMat);
                rim.rotation.z = Math.PI / 2;
                rim.position.set(...pos);
                group.add(rim);
            });

            // Lights
            const lightMat = new THREE.MeshStandardMaterial({
                color: 0xffffff,
                emissive: 0xffffff,
                emissiveIntensity: 0.3
            });

            [[-0.7, 0.55, 2.4], [0.7, 0.55, 2.4]].forEach(pos => {
                const light = new THREE.Mesh(
                    new THREE.BoxGeometry(0.35, 0.08, 0.02),
                    lightMat
                );
                light.position.set(...pos);
                group.add(light);
            });

            // Tail light
            const tailMat = new THREE.MeshStandardMaterial({
                color: 0xef4444,
                emissive: 0xef4444,
                emissiveIntensity: 0.2
            });
            const tail = new THREE.Mesh(
                new THREE.BoxGeometry(1.8, 0.06, 0.02),
                tailMat
            );
            tail.position.set(0, 0.7, -2.4);
            group.add(tail);

            egoVehicle = group;
            egoVehicle.position.set(0, 0, 8);
            scene.add(egoVehicle);
        }

        function createTraffic() {
            const colors = [0x3b82f6, 0x64748b, 0x171717, 0xf59e0b, 0xef4444];

            for (let i = 0; i < 6; i++) {
                const group = new THREE.Group();

                const mat = new THREE.MeshStandardMaterial({
                    color: colors[i % colors.length],
                    metalness: 0.4,
                    roughness: 0.4
                });

                // Body
                const body = new THREE.Mesh(
                    new THREE.BoxGeometry(1.9, 0.55, 4),
                    mat
                );
                body.position.y = 0.45;
                body.castShadow = true;
                group.add(body);

                // Cabin
                const cabin = new THREE.Mesh(
                    new THREE.BoxGeometry(1.7, 0.5, 2),
                    mat
                );
                cabin.position.set(0, 0.85, -0.2);
                cabin.castShadow = true;
                group.add(cabin);

                // Windows
                const glassMat = new THREE.MeshStandardMaterial({
                    color: 0x1e3a5f,
                    transparent: true,
                    opacity: 0.7
                });
                const frontGlass = new THREE.Mesh(
                    new THREE.PlaneGeometry(1.5, 0.4),
                    glassMat
                );
                frontGlass.position.set(0, 1.0, 0.75);
                frontGlass.rotation.x = -0.3;
                group.add(frontGlass);

                // Wheels
                const wheelMat = new THREE.MeshStandardMaterial({ color: 0x1a1a1a });
                [[-0.8, 0.3, 1.2], [0.8, 0.3, 1.2], [-0.8, 0.3, -1.3], [0.8, 0.3, -1.3]].forEach(pos => {
                    const wheel = new THREE.Mesh(
                        new THREE.CylinderGeometry(0.32, 0.32, 0.22, 24),
                        wheelMat
                    );
                    wheel.rotation.z = Math.PI / 2;
                    wheel.position.set(...pos);
                    group.add(wheel);
                });

                // Detection wireframe
                const boxGeo = new THREE.BoxGeometry(2.4, 1.6, 4.5);
                const edgesGeo = new THREE.EdgesGeometry(boxGeo);
                const edgesMat = new THREE.LineBasicMaterial({ color: 0x3b82f6, linewidth: 1 });
                const edges = new THREE.LineSegments(edgesGeo, edgesMat);
                edges.position.y = 0.65;
                group.add(edges);

                // Position
                const lane = (i % 3 - 1) * 3.8;
                const dist = -25 - i * 28;
                group.position.set(lane, 0, dist);
                group.userData = { speed: 0.08 + Math.random() * 0.04 };

                vehicles.push(group);
                scene.add(group);
            }
        }

        function onResize() {
            const container = document.getElementById('canvas-container');
            const width = container.clientWidth;
            const height = container.clientHeight;

            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        }

        function updateUI() {
            const speed = 68 + Math.sin(time * 0.3) * 8;
            document.getElementById('speed').textContent = Math.round(speed);

            const power = 35 + Math.sin(time * 0.5) * 20;
            document.getElementById('power').textContent = `${power > 0 ? '+' : ''}${Math.round(power)} kW`;

            document.getElementById('inference').textContent = `${(11 + Math.random() * 3).toFixed(1)}ms`;
            document.getElementById('fps').textContent = `${Math.round(34 + Math.random() * 4)} FPS`;
            document.getElementById('gpu').textContent = `${Math.round(88 + Math.random() * 8)}%`;

            const conf = 95 + Math.sin(time) * 3;
            document.getElementById('conf').textContent = `${conf.toFixed(1)}%`;
            document.getElementById('conf-bar').style.width = `${conf}%`;
        }

        function animate() {
            requestAnimationFrame(animate);
            time += 0.016;

            // Camera sway
            camera.position.x = Math.sin(time * 0.15) * 1;
            camera.lookAt(0, 0, -30);

            // Move traffic
            vehicles.forEach(v => {
                v.position.z += v.userData.speed;
                if (v.position.z > 40) {
                    v.position.z = -150;
                    v.position.x = (Math.floor(Math.random() * 3) - 1) * 3.8;
                }
            });

            // Ego subtle motion
            if (egoVehicle) {
                egoVehicle.rotation.z = Math.sin(time * 1.5) * 0.005;
            }

            updateUI();
            renderer.render(scene, camera);
        }

        init();
    </script>
</body>
</html>
